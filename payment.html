<!DOCTYPE html>
<html>
<head>
  <title>Razorpay Test Payment</title>
  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
</head>
<body>

<h2>Razorpay Test Payment</h2>

<input id="orderId" placeholder="Enter Order ID" />
<br><br>
<input id="token" placeholder="Paste USER JWT token" style="width:400px"/>
<br><br>
<button onclick="payNow()">Pay Now</button>

<script>
async function payNow() {
  const orderId = document.getElementById("orderId").value;
  const token = document.getElementById("token").value;

  if (!orderId || !token) {
    alert("Order ID & Token required");
    return;
  }

  // 1Ô∏è‚É£ Create Razorpay order (backend)
  const res = await fetch("http://localhost:3000/api/payments/create", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "Authorization": "Bearer " + token
    },
    body: JSON.stringify({ orderId })
  });

  const data = await res.json();

  // 2Ô∏è‚É£ Open Razorpay popup
  const options = {
    key:"rzp_test_S4AisTolf6oDwM" , // test key
    amount: data.amount,
    currency: data.currency,
    name: "Ecommerce Test",
    description: "Order Payment",
    order_id: data.razorpayOrderId,
    handler: async function (response) {

      // 3Ô∏è‚É£ Verify payment
      await fetch("http://localhost:3000/api/payments/verify", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": "Bearer " + token
        },
        body: JSON.stringify({
          orderId,
          razorpay_payment_id: response.razorpay_payment_id,
          razorpay_order_id: response.razorpay_order_id,
          razorpay_signature: response.razorpay_signature
        })
      });

      alert("Payment Successful üéâ");
    }
  };

  const rzp = new Razorpay(options);
  rzp.open();
}
</script>

</body>
</html>
